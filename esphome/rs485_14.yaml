substitutions:
  device_name: "wsdev0001"
  device_comment: "WaveShare RS485 TO ETH (B) - Modbus TCP to RTU Gateway"
  device_friendly: "WSDEV0001"

esphome:
  name: ${device_name}
  friendly_name: ${device_friendly}
  name_add_mac_suffix: false

esp32:
  board: esp32s3box
  flash_size: 16MB
  framework:
    type: arduino

logger:
  baud_rate: 0
  level: INFO

api:
  port: 4196
  encryption:
    key: "wmi04erTdlvLehiCAHiw+23dEYPYRtzSEBTgb3mzqpQ="

ota:
  - platform: esphome
    password: "b8cbdfcd263091fcda6057ad7e27a91b"

ethernet:
  type: W5500
  clk_pin: GPIO15
  mosi_pin: GPIO13
  miso_pin: GPIO14
  cs_pin: GPIO16
  interrupt_pin: GPIO12
  # Статический IP адрес (настройте под вашу сеть)
  # Если нужен DHCP, закомментируйте секцию manual_ip ниже
  # manual_ip:
    static_ip: 192.168.88.200  # IP адрес устройства (измените если нужно)
    gateway: 192.168.88.1       # Шлюз
    subnet: 255.255.255.0      # Маска подсети
    dns1: 192.168.88.3         # DNS сервер

web_server:
  port: 80

# ======================================================================
# RS485 / Modbus для датчиков температуры и влажности
# ======================================================================
uart:
  - id: modbus_uart
    tx_pin: GPIO17
    rx_pin: GPIO18
    baud_rate: 4800  # Согласно инструкции ComWinTop CWT-THXXS
    stop_bits: 1
    data_bits: 8
    parity: NONE

# RS485 transceiver (если есть пины DE/RE для управления направлением)
# Если пинов DE/RE нет, закомментируйте эту секцию
# rs485:
#   id: rs485_modbus
#   uart_id: modbus_uart
#   de_pin: GPIO19  # Уточните пин DE на вашей плате
#   re_pin: GPIO20  # Уточните пин RE на вашей плате

# Modbus контроллер для датчика CWT-THxxS (Брудер 4)
modbus:
  id: modbus1
  uart_id: modbus_uart
  send_wait_time: 60ms

modbus_controller:
  - id: cwt_th_brooder4
    modbus_id: modbus1
    address: 0x03  # Modbus адрес датчика (3) - согласно инструкции ComWinTop
    command_throttle: 60ms
    update_interval: 5s

# ======================================================================
# ДАТЧИКИ ТЕМПЕРАТУРЫ И ВЛАЖНОСТИ (Брудер 4)
# ======================================================================
# Датчик: ComWinTop CWT-THXXS (RS485 Modbus)
# Modbus адрес: 3 (0x03) - согласно инструкции
# Скорость: 4800 bps
# Регистры согласно инструкции:
#   - Register 1: Humidity (Влажность)
#   - Register 2: Temperature (Температура)
# Value scale: 0.1 (значение умножается на 0.1)
# ======================================================================
sensor:
  # Влажность Брудер 4 (Register 1 согласно инструкции)
  - platform: modbus_controller
    modbus_controller_id: cwt_th_brooder4
    name: "Брудер_4_Влажность"
    register_type: holding
    address: 1  # Register 1 = Humidity согласно инструкции
    value_type: U_WORD
    filters:
      - multiply: 0.1
      - round: 1
    accuracy_decimals: 1
    unit_of_measurement: "%"
    device_class: humidity
    state_class: measurement

  # Температура Брудер 4 (Register 2 согласно инструкции)
       - name: "rs485_Temperature_10"
        unique_id: "rs485_Temperature_10"
        address: 1
        slave: 10
        scan_interval: 10
        data_type: int16
        scale: 0.1
        precision: 1
        unit_of_measurement: "°C"

# ======================================================================
# Статус устройства
# ======================================================================
binary_sensor:
  - platform: status
    name: "WSDEV0001 Status"

# ======================================================================
# Кнопки управления
# ======================================================================
button:
  - platform: restart
    name: "WSDEV0001 Перезагрузка"
    entity_category: config

  - platform: safe_mode
    name: "WSDEV0001 Safe Mode"
    entity_category: config
