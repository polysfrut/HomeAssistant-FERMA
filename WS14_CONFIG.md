# Конфигурация WS14 - 30-канальный контроллер

## Информация об устройстве

**Модель:** Waveshare WS14  
**Тип:** 30DI-30RO (30 цифровых входов, 30 реле)  
**Протокол:** Modbus TCP to RTU  
**IP адрес:** 192.168.88.47  
**Port:** 4196  
**Web Port:** 80  

## Настройки устройства (из веб-интерфейса)

- **Device Name:** WS14
- **Firmware Version:** V1.486
- **Device MAC:** 04-EE-E8-17-5C-C8
- **Work Mode:** TCP Server
- **IP mode:** Static
- **Subnet Mask:** 255.255.255.0
- **Gateway:** 192.168.88.1
- **Baud Rate:** 9600
- **Databits:** 8
- **Stopbits:** 1
- **Parity:** None
- **Flow control:** None
- **Protocol:** Modbus TCP to RTU

## Конфигурация в Home Assistant

### Modbus TCP подключение

```yaml
modbus:
  - name: WS14
    type: tcp
    host: 192.168.88.47
    port: 4196
    delay: 10
    timeout: 3
```

### Реле (Switches) - 30 каналов

Все реле используют **coil** адреса (0x), начинаются с адреса 1.

**Распределение:**
- **Брудер 1:** Реле 1-15
- **Брудер 4:** Реле 16-30

**Entity ID формат:**
- Брудер 1: `switch.bruder_1_rele_1` ... `switch.bruder_1_rele_15`
- Брудер 4: `switch.bruder_4_rele_16` ... `switch.bruder_4_rele_30`

| Реле | Entity ID | Адрес | Брудер | Описание |
|------|-----------|-------|--------|----------|
| Реле 1 | `switch.bruder_1_rele_1` | 1 | Брудер 1 | - |
| Реле 2 | `switch.bruder_1_rele_2` | 2 | Брудер 1 | - |
| ... | ... | ... | ... | ... |
| Реле 15 | `switch.bruder_1_rele_15` | 15 | Брудер 1 | - |
| Реле 16 | `switch.bruder_4_rele_16` | 16 | Брудер 4 | - |
| Реле 17 | `switch.bruder_4_rele_17` | 17 | Брудер 4 | - |
| ... | ... | ... | ... | ... |
| Реле 30 | `switch.bruder_4_rele_30` | 30 | Брудер 4 | - |

### Цифровые входы (Binary Sensors) - 30 каналов

Все входы используют **discrete input** адреса (1x), начинаются с адреса 1.

**Распределение:**
- **Брудер 1:** Входы 1-15
- **Брудер 4:** Входы 16-30

**Entity ID формат:**
- Брудер 1: `binary_sensor.bruder_1_vkhod_1` ... `binary_sensor.bruder_1_vkhod_15`
- Брудер 4: `binary_sensor.bruder_4_vkhod_16` ... `binary_sensor.bruder_4_vkhod_30`

| Вход | Entity ID | Адрес | Брудер | Описание |
|------|-----------|-------|--------|----------|
| Вход 1 | `binary_sensor.bruder_1_vkhod_1` | 1 | Брудер 1 | - |
| Вход 2 | `binary_sensor.bruder_1_vkhod_2` | 2 | Брудер 1 | - |
| ... | ... | ... | ... | ... |
| Вход 15 | `binary_sensor.bruder_1_vkhod_15` | 15 | Брудер 1 | - |
| Вход 16 | `binary_sensor.bruder_4_vkhod_16` | 16 | Брудер 4 | - |
| Вход 17 | `binary_sensor.bruder_4_vkhod_17` | 17 | Брудер 4 | - |
| ... | ... | ... | ... | ... |
| Вход 30 | `binary_sensor.bruder_4_vkhod_30` | 30 | Брудер 4 | - |

## Подключенные устройства через Modbus RTU

WS14 работает как шлюз Modbus TCP to RTU. К нему могут быть подключены устройства по RS485:

- **Протокол:** Modbus RTU
- **Скорость:** 9600 baud
- **Параметры:** 8N1 (8 бит, нет parity, 1 stop bit)

### Пример: подключение датчиков температуры/влажности

Если к WS14 подключены датчики по Modbus RTU, их можно читать через WS14:

```yaml
modbus:
  - name: WS14
    # ... настройки подключения ...
    
    # Датчики температуры/влажности через Modbus RTU
    sensors:
      - name: "Температура (Modbus адрес 11)"
        address: 1
        register_type: holding
        slave: 11  # Modbus адрес устройства на RTU шине
        unit_of_measurement: "°C"
        data_type: int16
        scale: 0.1
        precision: 1
```

## Проверка работы

### 1. Проверка подключения

```bash
# На сервере Home Assistant
ha core states list | grep "switch.ws14"
ha core states list | grep "binary_sensor.ws14"
```

### 2. Тестирование реле

В Home Assistant:
- Настройки → Устройства и службы → WS14 → Реле
- Включите/выключите любое реле для проверки

### 3. Мониторинг входов

- Настройки → Устройства и службы → WS14 → Двоичные датчики
- Проверьте состояние входов

## Распределение каналов по брудерам

### Реле:
- **Брудер 1:** Реле 1-15 (`switch.bruder_1_rele_1` ... `switch.bruder_1_rele_15`)
- **Брудер 4:** Реле 16-30 (`switch.bruder_4_rele_16` ... `switch.bruder_4_rele_30`)

### Входы:
- **Брудер 1:** Входы 1-15 (`binary_sensor.bruder_1_vkhod_1` ... `binary_sensor.bruder_1_vkhod_15`)
- **Брудер 4:** Входы 16-30 (`binary_sensor.bruder_4_vkhod_16` ... `binary_sensor.bruder_4_vkhod_30`)

## Назначение каналов

**ВНИМАНИЕ:** Укажите назначение каждого реле и входа в этом разделе.

### Брудер 1 - Реле:
- Реле 1: [Указать назначение]
- Реле 2: [Указать назначение]
- ... (до Реле 15)

### Брудер 4 - Реле:
- Реле 16: [Указать назначение]
- Реле 17: [Указать назначение]
- ... (до Реле 30)

### Брудер 1 - Входы:
- Вход 1: [Указать назначение]
- Вход 2: [Указать назначение]
- ... (до Входа 15)

### Брудер 4 - Входы:
- Вход 16: [Указать назначение]
- Вход 17: [Указать назначение]
- ... (до Входа 30)

## Устранение неполадок

### Проблема: Реле не переключаются

1. Проверьте подключение к WS14:
   ```bash
   ping 192.168.88.47
   ```

2. Проверьте порт:
   ```bash
   telnet 192.168.88.47 4196
   ```

3. Проверьте логи Home Assistant:
   ```bash
   ha core logs | grep modbus
   ```

### Проблема: Входы не обновляются

1. Проверьте физическое подключение к входам
2. Проверьте настройки Modbus (slave адрес, тип регистра)
3. Увеличьте `delay` в конфигурации Modbus

## Следующие шаги

1. ✅ Настроены все 30 реле
2. ✅ Настроены все 30 входов
3. ⏳ Указать назначение каждого канала
4. ⏳ Настроить автоматизации для управления реле
5. ⏳ Настроить мониторинг входов
6. ⏳ Подключить датчики через Modbus RTU (если нужно)

